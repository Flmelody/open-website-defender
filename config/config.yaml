# Database configuration
# Supported drivers: sqlite (default), postgres, mysql
database:
  driver: sqlite
  # SQLite settings (used when driver is sqlite)
  # file-path: ./data/app.db

  # PostgreSQL settings (used when driver is postgres)
  # driver: postgres
  # host: localhost
  # port: 5432
  # name: open_website_defender
  # user: postgres
  # password: your_password
  # ssl-mode: disable

  # MySQL settings (used when driver is mysql)
  # driver: mysql
  # host: localhost
  # port: 3306
  # name: open_website_defender
  # user: root
  # password: your_password

# Cache configuration
cache:
  # Maximum memory in MB (default: 100)
  size-mb: 100
  # Multi-instance sync polling interval in seconds (default: 0 = disabled)
  # When multiple instances share the same database, set this to enable cross-instance
  # cache invalidation for security-critical data (blacklist, whitelist, geoblock,
  # system settings, WAF rules). Recommended: 5 for multi-instance deployments.
  sync-interval: 0

# Security configuration
security:
  # JWT secret key for token signing. If empty, a random key is generated on each restart.
  # IMPORTANT: Set this in production to persist tokens across restarts.
  jwt-secret: ""
  # Token expiration time in hours (default: 24)
  token-expiration-hours: 24
  # Recovery key for resetting admin 2FA when locked out.
  # If empty, the recovery endpoint is disabled.
  admin-recovery-key: ""
  # Only allow 2FA recovery from localhost (default: true)
  admin-recovery-local-only: true

  # CORS configuration
  cors:
    # Allowed origins. Empty list = reflect any origin (permissive, for dev only).
    # In production, set explicit origins:
    # allowed-origins:
    #   - "https://example.com"
    #   - "https://admin.example.com"
    allowed-origins: []
    allow-credentials: true

  # Security response headers
  headers:
    # Enable HSTS (only enable if behind HTTPS)
    hsts-enabled: false
    # X-Frame-Options: DENY, SAMEORIGIN, or empty to disable
    frame-options: "DENY"

# Rate limiting configuration
rate-limit:
  enabled: true
  # Global rate limit: max requests per minute per IP
  requests-per-minute: 100
  # Login-specific rate limit (stricter)
  login:
    requests-per-minute: 5
    # Lockout duration in seconds after exceeding login rate limit
    lockout-duration: 300

# Request filtering configuration (SQLi, XSS, Path Traversal detection)
request-filtering:
  enabled: true

# Geo-IP blocking configuration
geo-blocking:
  enabled: false
  # Path to MaxMind GeoLite2-Country.mmdb file
  # Download from: https://dev.maxmind.com/geoip/geolite2-free-geolocation-data
  database-path: ""
  # Blocked countries are managed via the admin API (POST /geo-block-rules)

# Server configuration
server:
  # Maximum request body size in MB (default: 10)
  max-body-size-mb: 10

# Default user credentials (created on first startup)
default-user:
  username: defender
  password: defender

# OAuth2/OIDC Provider configuration
oauth:
  enabled: true
  # Issuer URL - must match the public-facing URL of OWD (including root path)
  # Example: https://auth.example.com/wall
  issuer: "https://auth.example.com/wall"
  # Path to RSA private key (PEM format) for signing ID tokens.
  # If empty, a key is generated on each restart (tokens invalidated on restart).
  rsa-private-key-path: ""
  # Authorization code lifetime in seconds (default: 300 = 5 minutes)
  authorization-code-lifetime: 300
  # Access token lifetime in seconds (default: 3600 = 1 hour)
  access-token-lifetime: 3600
  # Refresh token lifetime in seconds (default: 2592000 = 30 days)
  refresh-token-lifetime: 2592000
  # ID token lifetime in seconds (default: 3600 = 1 hour)
  id-token-lifetime: 3600

# Threat detection configuration (auto-ban on anomalous behavior)
threat-detection:
  enabled: true
  # 4xx response threshold: ban IP after N 4xx responses in window
  status-code-threshold: 20
  status-code-window: 60          # seconds
  # Rate limit abuse: ban IP after N rate limit hits in window
  rate-limit-abuse-threshold: 5
  rate-limit-abuse-window: 300    # seconds
  # Default auto-ban duration in seconds (1 hour)
  auto-ban-duration: 3600
  # Path scan detection: ban IP after N distinct 404 paths in window
  scan-threshold: 10
  scan-window: 300                # seconds
  scan-ban-duration: 14400        # 4 hours
  # Brute force detection: ban IP after N failed logins in window
  brute-force-threshold: 10
  brute-force-window: 600         # seconds
  brute-force-ban-duration: 3600  # 1 hour

# JS Challenge (Proof-of-Work) configuration
js-challenge:
  enabled: false
  # Mode: off | suspicious | all
  mode: "suspicious"
  # Difficulty: number of leading zeros required in SHA256 hash (1-6)
  difficulty: 4
  # Pass cookie TTL in seconds (default: 24 hours)
  cookie-ttl: 86400
  # HMAC secret for signing cookies (auto-generated if empty)
  cookie-secret: ""

# Webhook notification configuration
webhook:
  # Webhook endpoint URL (empty = disabled)
  url: ""
  # Request timeout in seconds
  timeout: 5
  # Which events trigger webhook notifications
  events:
    - auto_ban
    - brute_force
    - scan_detected

# Bot Management
bot-management:
  enabled: true
  # Enable challenge escalation based on threat score
  challenge-escalation: false
  # CAPTCHA configuration
  captcha:
    # Provider: builtin or turnstile
    provider: "builtin"
    site-key: ""
    secret-key: ""
    # CAPTCHA pass cookie TTL in seconds (default: 24 hours)
    cookie-ttl: 86400

trustedProxies:
  - "127.0.0.1"
  - "::1"
