# 授权域管理

授权域是 Website Defender 中所有受保护域名的集中注册表，作为 IP 白名单域名绑定和用户访问作用域的**统一数据源**。

## 功能定位

在没有授权域管理的情况下，配置 IP 白名单条目或用户作用域时需要手动输入域名，容易出错且不一致。授权域通过以下方式解决这些问题：

- 提供一个**集中管理**所有受保护域名的位置
- 为 IP 白名单和用户管理表单中的域名字段提供**下拉选择器**
- 确保域名被移除时**级联清理**关联数据

## 管理方式

### 通过管理后台

1. 进入**授权域管理**页面
2. 输入域名（如 `gitea.example.com`）添加新的授权域
3. 查看所有已注册的授权域及创建时间
4. 删除不再需要的授权域

### 通过 API

| 方法 | 路径 | 说明 |
|------|------|------|
| `GET` | `/authorized-domains` | 查询授权域列表（分页） |
| `GET` | `/authorized-domains?all=true` | 查询全部授权域（用于下拉选项） |
| `POST` | `/authorized-domains` | 注册新的授权域 |
| `DELETE` | `/authorized-domains/:id` | 删除授权域 |

!!! note "唯一性约束"
    域名必须唯一。尝试注册已存在的域名将返回 `409 Conflict` 响应。

## 级联删除

删除授权域时，系统将自动执行以下清理操作：

1. **IP 白名单**：移除所有绑定该域名的白名单条目
2. **用户作用域**：从所有用户的作用域列表中移除该域名

!!! warning "级联影响"
    删除授权域可能会移除 IP 白名单条目并改变用户的访问权限。在删除正在使用的域名之前，请评估影响范围。

## 与其他功能的集成

### IP 白名单

添加 IP 白名单条目时，**授权域**字段提供一个下拉选择器，选项来自授权域注册表。也可以手动输入自定义值。

详见 [IP 黑白名单](ip-lists.md)。

### 用户作用域

配置用户访问作用域时，**授权域**字段提供一个多选下拉选择器，选项来自授权域注册表。用户可以选择多个域名，也可以输入自定义模式（如 `*.example.com`）。

详见[用户管理](user-management.md)和[域名作用域](domain-scopes.md)。

---

## 相关页面

- [IP 黑白名单](ip-lists.md) -- IP 白名单域名绑定
- [用户管理](user-management.md) -- 用户作用域配置
- [域名作用域](domain-scopes.md) -- 域名作用域匹配规则
- [API 参考](../api-reference/index.md) -- 完整的 API 接口文档
